#!/bin/bash

if [ ! -e ./jobs.config ]; then
    echo "jobs.config not found!"
    exit 1
fi

set -o allexport
source jobs.config

export NUM_SAMPLES=${NUM_SAMPLES:-3}
export REG_ROOT=${REG_ROOT:-$(pwd)}
export REG_SRIOV_NIC=${REG_SRIOV_NIC:-cx6}

ROOT_CONFIG=lab.config
function source_root_config {
    echo source_root_config ...
    echo  ${REG_ROOT}/$ROOT_CONFIG
    if [ ! -e ${REG_ROOT}/${ROOT_CONFIG} ];then
        echo "Not running from REG_ROOT, please define REG_ROOT"
        exit 0
    fi
    source ${REG_ROOT}/$ROOT_CONFIG
}

SRIOV_CONFIG=${REG_ROOT}/SRIOV-config/config.env
function source_sriov_config {
    echo source_sriov_config ...
    if [ ! -e ${SRIOV_CONFIG} ];then
        echo "SRIOV config not found:"  $SRIOV_CONFIG
        exit 0
    fi
    source $SRIOV_CONFIG
    echo sourced $SRIOV_CONFIG
}

source_root_config
source_sriov_config

function batch_run {
 for job in $JOBS;do
    echo --- begin $job ...
    pushd $job
    DRY_RUN=$DRY_RUN PROJECT=$PROJECT this-run --label $1
    pwd; ls *.log*
    popd
 done

}

#
# Usage: program [--sum ] [--run]
#

echo batch_run $TAG
batch_run $TAG

